import{visit as p}from"../../node_modules/unist-util-visit/index.mjs";import{hastUtilToMdast as d,hastUtilToMdastRoot as u,hastUtilToMdastTextarea as n,hastUtilToMdastListItem as f,hastUtilToMdastAll as y}from"../../vendor/hastUtilToMdast.ts.mjs";import{decodeEntity as h}from"./escape.mjs";import{parseJSX as k}from"./jsx.mjs";import x from"./parser.mjs";import T from"./stringifier.mjs";const c=(a,e)=>{var t,r;const s=e.tagName==="ol",l=s?(t=e.properties.type)!=null?t:"1":null,i=s?Number.parseInt((r=e.properties.start)!=null?r:1,10):null,m=a.handlers.span(a,e).map(o=>o.type!=="listItem"?{type:"listItem",data:{implied:!0},children:[o]}:o);return a(e,"list",{ordered:s,orderedType:l,start:i},m)},N=(...a)=>{const e=d(...a);return p(e,t=>{t.type.startsWith("text-jsxslack-")&&(t.type="text")}),e},b=a=>T(N(x(a),{document:!1,handlers:{root:(e,t)=>{p(t,i=>{i.type==="text"&&(i.value=h(i.value))});const r=u(e,t),s=(()=>r?Array.isArray(r)?{type:"root",children:r}:r:{type:"root",children:[]})();let l=0;return p(s,"text",i=>{i.type="text-jsxslack-"+l,l+=1}),r},code:(e,t)=>({...t,type:"inlineCode",children:e.handlers.span(e,t)}),pre:(e,t)=>({...t,type:"inlineCode",children:e.handlers.span(e,t),data:{codeBlock:!0}}),time:(e,t)=>({...n(e,t),data:{time:{datetime:t.properties.datetime,fallback:t.properties["data-fallback"]}}}),ul:c,ol:c,li:(e,t)=>{const r=f(e,t),s=Number.parseInt(t.properties.value,10);return!Number.isNaN(s)&&r&&(r.data={value:s}),r},span:(e,t)=>t.properties["data-escape"]?{...n(e,t),data:{escape:t.properties["data-escape"]}}:y(e,t)}})),v=a=>b(k(a,[]).join(""));export{v as mrkdwn};
