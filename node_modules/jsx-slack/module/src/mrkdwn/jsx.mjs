import E from"../date.mjs";import{JSXSlackError as q}from"../error.mjs";import{JSXSlack as b}from"../jsx.mjs";import{createComponent as w}from"../jsx-internals.mjs";import{detectSpecialLink as j}from"../utils.mjs";import{escapeChars as k,escapeEntity as h,escapeEverythingContents as p,escapeReplacers as m}from"./escape.mjs";const f=(t,r=!0)=>{let l="";for(const c of Object.keys(t))if(t[c]!=null&&["number","bigint","boolean","string","symbol"].includes(typeof t[c])){let i=t[c].toString();r&&(i=h(i)),l+=` ${c}="${i.replace(/"/g,"&quot;")}"`}return l},v=(t,r,l,c)=>{var i;const e=()=>l.join(""),s=(...n)=>c.length>0&&n.some(o=>o===c[c.length-1]),a=(...n)=>n.some(o=>c.includes(o));if(t==="br")return"<br />";if(s("pre","code")&&!["a","time"].includes(t))return e();switch(t){case"b":case"strong":return a("b","strong","time")?e():`<b>${m.bold(e())}</b>`;case"i":case"em":return a("i","em","time")?e():`<i>${k(e(),m.italic)}</i>`;case"s":case"strike":case"del":return a("s","strike","del","time")?e():`<s>${m.strikethrough(e())}</s>`;case"code":return a("time")?e():`<code>${m.code(e())}</code>`;case"p":return a("p")?e():`<p>${e()}</p>`;case"blockquote":return a("blockquote","ul","ol","time")?e():`<blockquote>${m.blockquote(e())}</blockquote>`;case"pre":return a("ul","ol","time")?e():`<pre>${p(e().replace(/`{3}/g,"``\u02CB"))}</pre>`;case"a":{if(a("a","time"))return e();let n=e();return!n&&r.href&&j(r.href)&&(n="specialLink"),`<a${f(r)}>${n}</a>`}case"time":{const n=(i=r.dateTime)!=null?i:r.datetime,o=Number.parseInt(n,10),u=new Date(Number.isNaN(o)?n:o*1e3),d=Math.floor(u.getTime()/1e3),g=e().replace(/\|/g,"\u01C0"),S=f({datetime:d}),y=r.fallback?f({"data-fallback":r.fallback.replace(/\|/g,"\u01C0")}):f({"data-fallback":E(u,g)},!1);return`<time${S}${y}>${p(g)}</time>`}case"small":case"span":case"ul":return`<${t}>${e()}</${t}>`;case"ol":case"li":return`<${t}${f(r)}>${e()}</${t}>`;default:throw new q(`Unknown HTML-like element: ${t}`,r.__source)}},C=w("Escape",b.Fragment.bind(null)),$=(t,r,l=!1)=>{var c;return((c=b.Children.map(t,i=>i))==null?void 0:c.reduce((i,e)=>{if(b.isValidElement(e)){const{type:s,props:a,children:n}=e.$$jsxslack;if(typeof s=="string"){const d=$(n,[...r,s]);return[...i,v(s,a||{},d,r)]}const o=!l&&s===C,u=$(n,r,o);return i.concat(o?k(u.join("")):u)}return[...i,h(e.toString())]},[]))||[]};export{C as Escape,$ as parseJSX};
